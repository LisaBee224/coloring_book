<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script   src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"   integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="   crossorigin="anonymous"></script>
  <script src='spectrum.js'></script>
<link rel='stylesheet' href='spectrum.css' />
<style>
#container{
  width:40%;
  margin:0 auto;
}

body{
  font-family:'Helvetica';
  color:#424242;
}
#undo{
  width:50%;
  padding:10px;
  margin:15%;
  border-radius:4px;
  box-shadow:none;
  font-size:1em;
  border-style:none;
  border:1px solid #6fccf7;
  background-color:#f4fcff;
  transition:background-color 1s ease;
}
#undo:hover{
  cursor:pointer;
  background-color:#c8e9f4;
}
#castle{
  float:left;
}
#sidebar {
  text-align:center;
float:right;
width:200px;
}
#swatches{
  width:200px;
  margin:0 auto;
}

.swatch{
  margin:3px;
}
.swatch:hover{
  cursor:pointer;
}
path{
  stroke:#000000;
  fill: white;
transition: fill 0.7s !important;
stroke-width:2;
}

path:hover{
  cursor:pointer;
}
.node{
  stroke:#000000;
  stroke-width:2;
}
#colorpicker{
  width:150px;
  margin:0 auto;
  margin-top:25px;
  text-align:center;
}
#custom{
  width:250px;
  margin:0 auto;
}

</style>
  </head>
<body>


<div id="container">
  <div id="sidebar">
    <h2>Choose from our palette</h2>
     <div id="swatches">
      <div id="current-swatch" style="width:180px; height:30px; border-radius:10px; background-color:#fff; border:1px solid #6fccf7; margin-bottom:2em;"></div>
         <div class="swatch" style="background-color:#6BCF2B; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#B8FFCE; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#9FFFBD; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#B24D4B; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#FFA09F; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#9FE3FF; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#4B95B2; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#FFC34A; width:40px; height:40px; border-radius:20px;float:left;"></div>
          <div class="swatch" style="background-color:#F2CAFF; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#CFFF71; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#9FFFBD; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#B2573D; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#B2AA3D; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#4EB251; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#CC5E02; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div class="swatch" style="background-color:#FF3322; width:40px; height:40px; border-radius:20px;float:left;"></div>
         <div id="selection" style="stroke:#0000ff; stroke-opacity: 1;fill:none" x="0" y="0" width="20" height="20"></div>
    </div>
    <div id="colorpicker">
      <h2>or choose your own colors!</h2>
      <input type='text' id="custom" />
      <button id="undo">undo</button>
      <button id="save">save</button>
    </div>
  </div>

  <div id="main">
   <!--?xml version="1.0" standalone="no"?-->

  <svg id="castle" xmlns="http://www.w3.org/2000/svg" width="300.000000pt" height="300.000000pt" viewBox="0 0 300.000000 300.000000" preserveAspectRatio="xMidYMid meet" style="fill:#fff; stroke: #000;">
  <g transform="translate(0.000000,300.000000) scale(0.100000,-0.100000)" fill="#363636">
  <path class="node" id="node1" d="M1480 2955 c0 -43 -1 -45 -29 -45 -56 0 -62 -45 -6 -52 27 -3 30 -7
  33 -46 2 -29 -1 -49 -11 -60 -8 -9 -18 -36 -22 -59 -9 -55 -44 -102 -180 -243
  -139 -143 -170 -197 -160 -279 4 -31 9 -210 11 -398 l5 -343 -31 0 -30 0 0
  250 c0 231 2 254 20 290 11 22 20 59 20 85 0 83 -34 138 -179 284 -99 100
  -141 185 -141 284 0 46 1 47 30 47 25 0 30 4 30 25 0 21 -5 25 -29 25 -28 0
  -30 3 -33 43 -3 37 -6 42 -28 42 -22 0 -25 -5 -28 -42 -3 -37 -6 -43 -26 -43
  -31 0 -50 -22 -34 -38 7 -7 22 -12 35 -12 21 0 23 -5 23 -50 0 -27 -4 -59 -10
  -72 -5 -13 -14 -42 -20 -66 -9 -35 -32 -65 -119 -155 -141 -145 -171 -193
  -171 -267 0 -36 7 -70 20 -95 18 -36 20 -59 20 -287 0 -202 -3 -248 -13 -248
  -8 0 -32 -13 -54 -29 -61 -44 -73 -85 -73 -247 0 -134 0 -135 -27 -158 l-27
  -23 27 -25 27 -25 0 -157 c0 -89 -4 -156 -9 -156 -5 0 -17 -7 -25 -16 -18 -18
  -5 -54 19 -54 13 0 15 -40 15 -270 l0 -270 1200 0 1200 0 0 270 c0 230 2 270
  15 270 24 0 37 36 19 54 -8 9 -20 16 -25 16 -5 0 -9 67 -9 156 0 154 0 157 25
  180 27 25 25 50 -6 59 -17 6 -19 18 -19 148 0 117 -4 149 -19 183 -20 44 -60
  81 -98 90 l-23 6 0 247 c0 227 2 250 20 286 29 58 27 130 -7 194 -16 28 -76
  100 -135 161 -80 83 -110 121 -123 157 -9 27 -21 55 -25 64 -5 9 -10 40 -11
  70 -3 52 -2 54 23 57 56 7 55 46 -2 54 -21 3 -25 7 -22 34 4 39 -23 71 -44 53
  -8 -6 -14 -29 -14 -50 0 -37 -2 -39 -31 -39 -26 0 -30 -3 -27 -22 2 -17 11
  -24 31 -26 25 -3 27 -7 27 -49 0 -47 -9 -86 -39 -158 -9 -24 -62 -88 -130
  -159 -70 -74 -120 -136 -132 -163 -25 -58 -24 -128 1 -178 18 -36 20 -59 20
  -287 l0 -248 -30 0 -30 0 0 323 c0 261 3 331 16 372 31 102 -5 174 -173 348
  -119 123 -173 200 -173 248 0 9 -7 22 -15 29 -11 9 -15 27 -13 59 3 43 5 46
  33 49 56 7 51 52 -6 52 -28 0 -29 2 -29 45 0 38 -3 45 -20 45 -17 0 -20 -7
  -20 -45z m175 -555 c146 -151 167 -188 145 -256 l-12 -34 -282 0 c-206 0 -285
  3 -294 12 -18 18 -15 94 5 126 9 15 65 77 123 137 59 61 119 127 135 148 l28
  38 26 -33 c13 -18 70 -80 126 -138z m-895 -29 c0 -4 43 -52 95 -105 117 -119
  143 -153 147 -191 l3 -30 -252 -3 -253 -2 0 28 c0 37 16 59 137 184 57 59 103
  111 103 117 0 6 5 11 10 11 6 0 10 -4 10 -9z m1513 -14 c8 -13 54 -64 102
  -113 100 -102 125 -138 125 -176 l0 -28 -248 0 c-137 0 -251 2 -254 5 -2 3 -3
  19 0 36 3 22 37 64 123 155 66 69 119 130 119 135 0 17 17 9 33 -14z m-523
  -307 c0 -6 -90 -10 -250 -10 -160 0 -250 4 -250 10 0 6 90 10 250 10 160 0
  250 -4 250 -10z m-780 -70 c0 -6 -80 -10 -219 -10 -136 0 -222 4 -226 10 -4 7
  72 10 219 10 144 0 226 -4 226 -10z m810 -165 l0 -175 -277 2 -278 3 -3 173
  -2 172 280 0 280 0 0 -175z m695 165 c-4 -6 -90 -10 -226 -10 -139 0 -219 4
  -219 10 0 6 82 10 226 10 147 0 223 -3 219 -10z m-1515 -200 l0 -140 -210 0
  -210 0 0 140 0 140 210 0 210 0 0 -140z m1500 0 l0 -140 -210 0 -210 0 0 140
  0 140 210 0 210 0 0 -140z m-1623 -256 c30 -15 83 -70 83 -87 0 -4 -76 -7
  -170 -7 -97 0 -170 4 -170 9 0 18 54 74 85 87 42 18 130 17 172 -2z m784 -19
  c23 -17 49 -40 57 -52 l14 -23 -191 0 c-187 0 -191 0 -181 20 12 23 65 65 100
  79 14 6 55 10 92 8 56 -2 74 -8 109 -32z m700 23 c37 -12 69 -40 88 -75 l12
  -23 -171 0 c-160 0 -170 1 -161 18 14 26 63 70 91 81 34 13 100 13 141 -1z
  m-1475 -283 c84 -25 190 -130 209 -207 l7 -28 -319 0 c-176 0 -322 3 -326 6
  -8 9 36 94 69 134 33 39 95 79 149 96 55 17 151 17 211 -1z m790 -13 c82 -42
  154 -123 168 -189 l8 -33 -312 0 -312 0 6 31 c14 71 128 186 205 208 60 17
  190 8 237 -17z m778 -7 c63 -32 114 -83 146 -144 38 -76 57 -71 -301 -71
  l-321 0 7 28 c19 77 121 180 207 208 27 9 74 13 124 11 66 -3 92 -9 138 -32z
  m-1336 -452 l-3 -158 -337 -3 -338 -2 0 160 0 160 340 0 341 0 -3 -157z m750
  0 l-3 -158 -325 0 -325 0 -3 158 -3 157 331 0 331 0 -3 -157z m772 -3 l0 -160
  -337 2 -338 3 -3 158 -3 157 341 0 340 0 0 -160z m-1522 -452 l2 -218 -119 0
  -120 0 1 154 c0 177 -9 204 -73 230 -48 20 -99 6 -133 -35 -26 -30 -26 -33
  -26 -190 l0 -159 -105 0 -105 0 0 213 c0 118 3 217 7 220 4 4 155 6 337 5
  l331 -3 3 -217z m750 0 l2 -218 -95 0 -95 0 0 147 c0 142 -1 148 -26 184 -57
  83 -171 83 -228 0 -25 -36 -26 -42 -26 -184 l0 -147 -95 0 -95 0 0 213 c0 118
  3 217 7 220 4 4 151 6 327 5 l321 -3 3 -217z m770 0 l2 -218 -105 0 -105 0 0
  159 c0 157 0 160 -26 190 -35 42 -85 55 -135 34 -63 -25 -71 -50 -71 -229 l0
  -154 -119 0 -119 0 0 213 c0 118 3 217 7 220 4 4 155 6 337 5 l331 -3 3 -217z" style="position: relative;"></path>
  <path class="node" id="node2" d="M1467 1882 c-13 -14 -17 -39 -17 -104 0 -79 2 -86 21 -91 12 -3 35
  -3 50 0 l29 6 0 87 c0 71 -3 90 -18 103 -24 22 -45 21 -65 -1z" style="position: relative;"></path>
  <path class="node" id="node3" d="M717 1812 c-11 -12 -17 -36 -17 -69 l0 -51 46 -4 c25 -2 47 -1 50 1
  2 2 4 28 4 56 0 75 -44 110 -83 67z" style="position: relative;"></path>
  <path class="node" id="node4" d="M2210 1811 c-5 -11 -10 -42 -10 -70 l0 -51 50 0 50 0 0 53 c0 40 -5
  58 -18 70 -25 23 -59 21 -72 -2z" style="position: relative;"></path>
  <path class="node" id="node5" d="M621 856 c-8 -9 -11 -47 -9 -107 l3 -94 45 0 45 0 3 84 c2 62 -1 89
  -13 107 -17 27 -56 32 -74 10z" style="position: relative;"></path>
  <path class="node" id="node6" d="M767 852 c-13 -15 -17 -39 -17 -110 l0 -92 45 0 c36 0 45 4 46 18 3
  103 -1 175 -11 187 -17 20 -43 19 -63 -3z" style="position: relative;"></path>
  <path class="node" id="node7" d="M1396 851 c-14 -15 -16 -35 -14 -107 l3 -89 45 0 45 0 3 89 c3 94 -9
  126 -48 126 -9 0 -25 -8 -34 -19z" style="position: relative;"></path>
  <path class="node" id="node8" d="M1536 851 c-14 -15 -16 -35 -14 -107 l3 -89 45 0 45 0 3 89 c3 94 -9
  126 -48 126 -9 0 -25 -8 -34 -19z" style="position: relative;"></path>
  <path class="node" id="node9" d="M2171 857 c-13 -17 -15 -31 -13 -129 l2 -78 45 0 45 0 0 93 c0 78 -3
  97 -18 110 -22 20 -46 22 -61 4z" style="position: relative;"></path>
  <path class="node" id="node10" d="M2305 846 c-12 -18 -15 -45 -13 -107 l3 -84 45 0 45 0 3 94 c2 60 -1
  98 -9 107 -18 22 -57 17 -74 -10z" style="position: relative;"></path>
  </g>
  <g transform="translate(0.000000,300.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="none">


  <path class="node" id="node13" d="M1475 2533 c-16 -21 -76 -87 -135 -148 -58 -60 -114 -122 -123 -137
  -20 -32 -23 -108 -5 -126 9 -9 88 -12 294 -12 l282 0 12 34 c22 68 1 105 -145
  256 -56 58 -113 120 -126 138 l-26 33 -28 -38z" style="position: relative;"></path>
  <path class="node" id="node14" d="M740 2369 c0 -6 -46 -58 -103 -117 -121 -125 -137 -147 -137 -184 l0
  -28 253 2 252 3 -3 30 c-4 38 -30 72 -147 191 -52 53 -95 101 -95 105 0 5 -4
  9 -10 9 -5 0 -10 -5 -10 -11z" style="position: relative;"></path>
  <path class="node" id="node15" d="M2240 2371 c0 -5 -53 -66 -119 -135 -86 -91 -120 -133 -123 -155 -3
  -17 -2 -33 0 -36 3 -3 117 -5 254 -5 l248 0 0 28 c0 38 -25 74 -125 176 -48
  49 -94 100 -102 113 -16 23 -33 31 -33 14z" style="position: relative;"></path>
  <path class="node" id="node16" d="M1250 2050 c0 -6 90 -10 250 -10 160 0 250 4 250 10 0 6 -90 10 -250
  10 -160 0 -250 -4 -250 -10z" style="position: relative;"></path>
  <path class="node" id="node17" d="M525 1980 c4 -6 90 -10 226 -10 139 0 219 4 219 10 0 6 -82 10 -226
  10 -147 0 -223 -3 -219 -10z" style="position: relative;"></path>
  <path class="node" id="node18" d="M1222 1818 l3 -173 278 -3 277 -2 0 175 0 175 -280 0 -280 0 2 -172z
  m310 65 c15 -13 18 -32 18 -103 l0 -87 -29 -6 c-15 -3 -38 -3 -50 0 -19 5 -21
  12 -21 91 0 65 4 90 17 104 20 22 41 23 65 1z" style="position: relative;"></path>
  <path class="node" id="node19" d="M2030 1980 c0 -6 80 -10 219 -10 136 0 222 4 226 10 4 7 -72 10 -219
  10 -144 0 -226 -4 -226 -10z" style="position: relative;"></path>
  <path class="node" id="node20" d="M540 1780 l0 -140 210 0 210 0 0 140 0 140 -210 0 -210 0 0 -140z
  m242 33 c13 -12 18 -30 18 -68 0 -28 -2 -54 -4 -56 -3 -2 -25 -3 -50 -1 l-46
  4 0 51 c0 75 39 109 82 70z" style="position: relative;"></path>
  <path class="node" id="node21" d="M2040 1780 l0 -140 210 0 210 0 0 140 0 140 -210 0 -210 0 0 -140z
  m242 33 c13 -12 18 -30 18 -70 l0 -53 -50 0 -50 0 0 51 c0 28 5 59 10 70 13
  23 47 25 72 2z" style="position: relative;"></path>
  <path class="node" id="node22" d="M665 1526 c-31 -13 -85 -69 -85 -87 0 -5 73 -9 170 -9 94 0 170 3
  170 7 0 17 -53 72 -83 87 -42 19 -130 20 -172 2z" style="position: relative;"></path>
  <path class="node" id="node23" d="M1420 1529 c-35 -14 -88 -56 -100 -79 -10 -20 -6 -20 181 -20 l191 0
  -14 23 c-8 12 -34 35 -57 52 -35 24 -53 30 -109 32 -37 2 -78 -2 -92 -8z" style="position: relative;"></path>
  <path class="node" id="node24" d="M2180 1529 c-28 -11 -77 -55 -91 -81 -9 -17 1 -18 161 -18 l171 0
  -12 23 c-39 73 -146 109 -229 76z" style="position: relative;"></path>
  <path class="node" id="node25" d="M635 1246 c-54 -17 -116 -57 -149 -96 -33 -40 -77 -125 -69 -134 4
  -3 150 -6 326 -6 l319 0 -7 28 c-19 77 -125 182 -209 207 -60 18 -156 18 -211
  1z" style="position: relative;"></path>
  <path class="node" id="node26" d="M1399 1249 c-77 -22 -191 -137 -205 -208 l-6 -31 312 0 312 0 -8 33
  c-14 66 -86 147 -168 189 -47 25 -177 34 -237 17z" style="position: relative;"></path>
  <path class="node" id="node27" d="M2152 1246 c-86 -28 -188 -131 -207 -208 l-7 -28 321 0 c358 0 339
  -5 301 71 -32 61 -83 112 -146 144 -46 23 -72 29 -138 32 -50 2 -97 -2 -124
  -11z" style="position: relative;"></path>
  <path class="node" id="node28" d="M400 770 l0 -160 338 2 337 3 3 158 3 157 -341 0 -340 0 0 -160z
  m295 76 c12 -18 15 -45 13 -107 l-3 -84 -45 0 -45 0 -3 94 c-2 60 1 98 9 107
  18 22 57 17 74 -10z m135 9 c10 -12 14 -84 11 -187 -1 -14 -10 -18 -46 -18
  l-45 0 0 92 c0 71 4 95 17 110 20 22 46 23 63 3z" style="position: relative;"></path>
  <path class="node" id="node29" d="M1172 773 l3 -158 325 0 325 0 3 158 3 157 -331 0 -331 0 3 -157z
  m292 78 c14 -15 16 -35 14 -107 l-3 -89 -45 0 -45 0 -3 89 c-3 94 9 126 48
  126 9 0 25 -8 34 -19z m140 0 c14 -15 16 -35 14 -107 l-3 -89 -45 0 -45 0 -3
  89 c-3 94 9 126 48 126 9 0 25 -8 34 -19z" style="position: relative;"></path>
  <path class="node" id="node30" d="M1922 773 l3 -158 338 -3 337 -2 0 160 0 160 -340 0 -341 0 3 -157z
  m310 80 c15 -13 18 -32 18 -110 l0 -93 -45 0 -45 0 -2 78 c-2 98 0 112 13 129
  15 18 39 16 61 -4z m147 3 c8 -9 11 -47 9 -107 l-3 -94 -45 0 -45 0 -3 84 c-2
  62 1 89 13 107 17 27 56 32 74 10z" style="position: relative;"></path>
  <path class="node" id="node31" d="M407 533 c-4 -3 -7 -102 -7 -220 l0 -213 105 0 105 0 0 159 c0 157 0
  160 26 190 34 41 85 55 133 35 64 -26 73 -53 73 -230 l-1 -154 120 0 119 0 -2
  218 -3 217 -331 3 c-182 1 -333 -1 -337 -5z" style="position: relative;"></path>
  <path class="node" id="node32" d="M1177 533 c-4 -3 -7 -102 -7 -220 l0 -213 95 0 95 0 0 147 c0 142 1
  148 26 184 57 83 171 83 228 0 25 -36 26 -42 26 -184 l0 -147 95 0 95 0 -2
  218 -3 217 -321 3 c-176 1 -323 -1 -327 -5z" style="position: relative;"></path>
  <path class="node" id="node33" d="M1927 533 c-4 -3 -7 -102 -7 -220 l0 -213 119 0 119 0 0 154 c0 179
  8 204 71 229 50 21 100 8 135 -34 26 -30 26 -33 26 -190 l0 -159 105 0 105 0
  -2 218 -3 217 -331 3 c-182 1 -333 -1 -337 -5z" style="position: relative;"></path>
  </g>
  </svg>
 <canvas id="canvas" width=800 height=600>
</canvas>
  </div>

</div>
<script>
$("#custom").spectrum({
    color: "#ffffff",
    showInput: true,
    preferredFormat: "hex",
    palette: [["red", "rgba(0, 255, 0, .5)", "rgb(0, 0, 255)"]],
    showSelectionPalette: true
});
$(".sp-val").mouseup(function(){
  _currentFill = ($(".sp-input").val());

});
$(".sp-choose").click(function(){
  _currentFill = ($(".sp-input").val());

});
</script>
<script>
  var fillSpeed = 5
  var _currentFill = "fill:#000";
  var allChanges = [];
  var change ={};
  var count =-1;
    var $swatches = $("#swatches");
    $swatches.click(function (event) { 
      $swatch = $(event.target);
      $("#selection", $swatches).attr('background-color');
      $("#selection", $swatches).attr('background-color');
      _currentFill = $swatch.css('background-color'); 
      $("#current-swatch").css('background-color', _currentFill);
    })


    $("#castle").click(function (event) {
      count++;

      $color = _currentFill;
      change[event.target.id] = $color;
      allChanges.push(change);
      change = {};
       $(event.target).css('fill', _currentFill);

    });

    $("#undo").click(function(){
    count--;
      var path = Object.keys(allChanges[count]).shift();
      var oldFill = Object.keys(allChanges[count]).map(function(key){
        return allChanges[count][key];
      }).shift();
      $("#"+path).css('fill', oldFill);
      
    });
</script>
<script>
$("#save").click(function(){
var svgText = document.getElementById("castle").outerHTML;
var myCanvas = document.getElementById("canvas");
var ctxt = myCanvas.getContext("2d");

function drawInlineSVG(ctx, rawSVG, callback) {

    var svg = new Blob([rawSVG], {type:"image/svg+xml;charset=utf-8"}),
        domURL = self.URL || self.webkitURL || self,
        url = domURL.createObjectURL(svg),
        img = new Image;

    img.onload = function () {
        ctx.drawImage(this, 0, 0);     
        domURL.revokeObjectURL(url);
        callback(this);
    };

    img.src = url;
}

// usage:
drawInlineSVG(ctxt, svgText, function() {
    console.log(canvas.toDataURL());  // -> PNG data-uri
});
});
</script>

</body>
</html>